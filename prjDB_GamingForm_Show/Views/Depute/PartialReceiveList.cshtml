@model IEnumerable<prjDB_GamingForm_Show.Models.Entities.DeputeRecord>



@{
    int intingCount = Model.Count(_ => _.ApplyStatusId != 16);
    string stringCount = intingCount == 0 ? "" : $"({intingCount})";

    int intcomCount = Model.Count(_ => _.ApplyStatusId == 16);
    string strcomCount = intcomCount == 0 ? "" : $"({intcomCount})";
}
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation" style="margin-bottom: 0px;">
        <button class="nav-link active" id="receive-ing-tab" data-bs-toggle="tab" data-bs-target="#receive-ing-tab-pane" type="button" role="tab" aria-controls="receive-ing-tab-pane" aria-selected="true">已投遞 @stringCount</button>
    </li>
    <li class="nav-item" role="presentation" style="margin-bottom: 0px;">
        <button class="nav-link" id="receive-com-tab" data-bs-toggle="tab" data-bs-target="#receive-com-tab-pane" type="button" role="tab" aria-controls="receive-com-tab-pane" aria-selected="false">已完成 @strcomCount</button>
    </li>
</ul>


<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="receive-ing-tab-pane" role="tabpanel" aria-labelledby="receive-ing-tab" tabindex="0">

        <table class="table table-dark table-striped table-bordered align-middle">

            <tr class="text-center">
                <th hidden></th>
                <th class="col-*">
                    #
                </th>
                <th class="col-2">
                    標題
                </th>
                <th class="col-2">
                    自介內容
                </th>
                <th class="col-1">
                    狀態
                </th>
                <th class="col-1">
                    報酬
                </th>
                <th class="col-2">
                    更新時間
                </th>
                <th class="col-3"></th>
            </tr>


            @{
                int count = 0;
                foreach (var i in Model)
                {
                    if (i.ApplyStatusId == 16)
                    {
                        continue;
                    }
                    count++;
                    <tr>
                        <td hidden>@i.Id</td>
                        <td hidden>@i.DeputeId</td>
                        <td class="text-center">
                            @count
                        </td>
                        <td class="text-center">
                            @i.Depute.Title
                        </td>
                        <td class="text-truncate col-2" style="max-width: 150px;">
                            @{
                                if (i.RecordContent != null)
                                {
                                    @i.RecordContent
                                }
                                else
                                {
                                    @:未提供自介內容
                                }
                            }
                        </td>
                        <td class="text-center">
                            @i.ApplyStatus.Name
                        </td>
                        <td class="text-center">
                            @i.Depute.Salary.ToString("$###,###,##0")
                        </td>
                        <td class="text-center">
                            @i.Depute.Modifiedate.ToString("yyyy/MM/dd HH:mm")
                        </td>
                        <td class="text-center">
                            @{
                                if (@i.ApplyStatus.Name.Contains("合作中") || @i.ApplyStatus.Name.Contains("已完成"))
                                {
                                    string replyDisabled = i.ApplyStatus.Name.Contains("已完成") ? " disabled" : "";
                                    @Html.ActionLink("完成", "ReplyDepute", new { id = i.Id }, new { @class = "btn btn-success"+replyDisabled })
                                }
                            }
                            @Html.ActionLink("詳細資料", "Details", new { id = i.Id }, new { @class = "btn btn-secondary" })
                            <button class="btn btn-danger" onclick="deleteDeputeRecordAlert(@i.Id)">撤回</button>
                        </td>
                    </tr>
                }
            }
        </table>
    </div>
    <div class="tab-pane fade" id="receive-com-tab-pane" role="tabpanel" aria-labelledby="receive-com-tab" tabindex="0">
        <table class="table table-dark table-striped table-bordered align-middle">

            <tr class="text-center">
                <th hidden></th>
                <th class="col-*">
                    #
                </th>
                <th class="col-2">
                    標題
                </th>
                <th class="col-2">
                    自介內容
                </th>
                <th class="col-1">
                    狀態
                </th>
                <th class="col-1">
                    報酬
                </th>
                <th class="col-2">
                    更新時間
                </th>
                <th class="col-3"></th>
            </tr>


            @{
                int count2 = 0;
                foreach (var i in Model)
                {
                    if (i.ApplyStatusId != 16)
                    {
                        continue;
                    }
                    count2++;
                    <tr>
                        <td hidden>@i.Id</td>
                        <td hidden>@i.DeputeId</td>
                        <td class="text-center">
                            @count2
                        </td>
                        <td class="text-center">
                            @i.Depute.Title
                        </td>
                        <td class="text-truncate" style="max-width: 150px;">
                            @{
                                if (i.RecordContent != null)
                                {
                                    @i.RecordContent
                                }
                                else
                                {
                                    @:未提供自介內容
                                }
                            }
                        </td>
                        <td class="text-center">
                            @i.ApplyStatus.Name
                        </td>
                        <td class="text-center">
                            @i.Depute.Salary.ToString("$###,###,##0")
                        </td>
                        <td class="text-center">
                            @i.Depute.Modifiedate.ToString("yyyy/MM/dd HH:mm")
                        </td>
                        <td class="text-center">
                            @Html.ActionLink("詳細資料", "Details", new { id = i.Id }, new { @class = "btn btn-secondary" })
                        </td>
                    </tr>
                }
            }
        </table>
    </div>
</div>


<script>
    function deleteDeputeRecordAlert(deputeRecordID) {
        const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: "btn btn-success",
                cancelButton: "btn btn-danger"
            },
            buttonsStyling: false
        });
        swalWithBootstrapButtons.fire({
            color: "#D0D0D0",
            background: "#343a40",
            scrollbarPadding: false,
            title: "確定撤回嗎?",
            text: "此動作無法復原!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "是的，確定撤回!",
            cancelButtonText: "取消!",
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`@Url.Content("~/depute/DeleteDeputeRecord")?id=${deputeRecordID}`);
                swalWithBootstrapButtons.fire({
                    color: "#D0D0D0",
                    background: "#343a40",
                    scrollbarPadding: false,
                    title: "已撤回!",
                    text: "該應徵已撤回",
                    icon: "success"
                });
                setTimeout(function () {
                    reloadPartial();
                }, 500);
            } else if (
                /* Read more about handling dismissals below */
                result.dismiss === Swal.DismissReason.cancel
            ) {
                swalWithBootstrapButtons.fire({
                    color: "#D0D0D0",
                    background: "#343a40",
                    scrollbarPadding: false,
                    title: "已取消",
                    text: "應徵尚未撤回",
                    icon: "error"
                });
            }
        });
    }

    function reloadPartial() {
        $.ajax({
            url: '@Url.Action("PartialReceiveList", "depute")',
            type: "GET",
            success: function (result) {
                $('#divReceivePart').html(result);
            },
            error: function (error) {
                console.error('Error reloading partial view:', error);
            }
        })
    }
</script>
