@model IEnumerable<prjDB_GamingForm_Show.ViewModels.CShopPageViewModel>
@* @model prjDB_GamingForm_Show.ViewModels.CShopPageViewModel *@

@{
    ViewBag.Title = "產品目錄";
}

<!-- Header-->
<header class="" id="headerCarousel">
</header>
<body>
 @*  
<p>
    @using (Html.BeginForm())
    {
        @*        @: 關鍵字 @Html.TextBox("txtKeyword")
    <input type="submit" value="查詢" />*@


        <!-- Search Start -->
        <div class="container-fluid bg-primary mb-5 wow fadeIn" data-wow-delay="0.1s" style="padding: 35px;">
            <div class="container">
                <div class="row g-2">
                    <div class="col-md-5">
                        <div class="row g-2">
                            <div class="col-md-4">
                                <input type="text" class="form-control border-0" placeholder="Keyword" id="Kw" name="txtKeyword" />
                            </div>
                            <div class="col-md-2">
                                <input id="QueryAjax" type="button" value="查詢" style="padding: 0.375rem 0.75rem" />
                            </div>
                            <div class="col-md-3">
                                @Html.ActionLink("我要上架", "Create", "Shop",null, new { @class = "btn btn-outline-dark mt-auto" })
                            </div>

                            @*     @if (Context.Session.GetInt32(CDictionary.SK_UserID) == null)
                                { <div class="text-center">
                                        @Html.ActionLink("願望清單", "LoveList", "Shop", new { id = Context.Session.GetInt32(CDictionary.SK_UserID) }, new { @class = "btn btn-outline-dark mt-auto", id = "myLink", data_bs_toggle = "modal", data_bs_target = "#staticBackdrop" })
                                    </div>
                                }else
                                {
                                    <div class="text-center">
                                        @Html.ActionLink("願望清單", "LoveList", "Shop", new { id = Context.Session.GetInt32(CDictionary.SK_UserID) }, new { @class = "btn btn-outline-dark mt-auto" })
                                    </div>
                                } *@

                               
                        </div>
                    </div>
                    
                    
                    <div class="container" style="margin-left:-41px">
                        <ul style="margin-top:10px">
                            <li style="list-style-type: none; float:left">
                                <select id="SortControl" class="form-select border-0">
                                    <option selected>Location</option>
                                    <option value="1">最熱銷</option>
                                    <option value="2">最新上架</option>
                                    <option value="3">價格:高到低</option>
                                    <option value="4">價格:低到高</option>
                                </select>
                            </li>
                        </ul>
                        <!-- 類別標籤 -->
                   @*      <ul class="nav-item dropdown" style="list-style-type: none" id="tags">
                            
                            <li style="list-style-type: none; float:left;padding-left:10px;padding-top:7px" id="tags">
                                <option class="nav-link dropdown-toggle tagclick" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="width:100px">遊戲商城</option>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="Subtags">
                                  
                                </ul>
                            </li>

                        </ul> *@
                    </div>
                    <!-- 類別標籤END -->
                </div>
               
            </div>
        </div>
    }

    <!-- Search End -->
</p>
<div id="Eroor"></div>

<div class="container px-4 px-lg-5 mt-5">
         <div class ="" id="BodySelSub"></div>
        <div class=""  id="Hotproduct"></div>
        <div class="" id="Seenproduct"></div>
        <div class="" id="YourTop5"></div>
    <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center" id="ContentProduct">

       @foreach (var item in Model)
            {
         
            <div class="col mb-5">
                <div class="card h-100">
                    <!-- Sale badge-->
                    <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Sale</div>
                    <!-- Product image-->
                        <a href='@Url.Content("~/Shop/Details")?id=@item.ProductId'>
                    <img class="card-img-top" src="~/images/shop/@item.FImagePath" alt="..." style="height:25vh; " />
                    </a>
                    <!-- Product details-->
                            <div class="card-body p-4" style="background-color:#4F4F4F">
                        <div class="text-center">
                            <div>
                                @{
                                    string[] tags = item.SubTagName.Split('/');
                                    foreach (var t in tags)
                                    {
                                      <span class="badge text-bg-light">@t</span>
                                    }
                                }
                            </div>
                            <!-- Product name-->
                             <h5 class="fw-bolder" style="color:black">@Html.DisplayFor(modelItem => item.ProductName)</h5>
                            <!-- Product reviews-->
                            <div class="d-flex justify-content-center small text-warning mb-2">
                                <div class="bi-star-fill"></div>
                                <div class="bi-star-fill"></div>
                                <div class="bi-star-fill"></div>
                                <div class="bi-star-fill"></div>
                                <div class="bi-star-fill"></div>
                            </div>
                            <!-- Product price-->
                            <span class="text-muted text-decoration-line-through">@Html.DisplayFor(modelItem => item.Price)</span>
                            <span style="color:black">@Html.DisplayFor(modelItem => item.Price)</span>
                        </div>
                    </div>
                    
                    

                    <!-- Product actions-->
                            <div class="card-footer p-4 pt-0 border-top-0" style="background-color:#4F4F4F">
                        @using (Html.BeginForm("AddToCar", "Shop", FormMethod.Post))
                        {
                            @Html.TextBox("txtCount", "1", new { @class = "form-control text-center me-3 textbox", @style="display:none"})
                            <div class="text-center">
                                @Html.ActionLink("查看商品", "Details", "Shop", new { id = item.ProductId }, new { @class = "btn btn-outline-dark mt-auto" })
                            </div>
                            <div class="text-center">
                                @Html.ActionLink("測試修改", "Edit", "Shop", new { id = item.ProductId }, new { @class = "btn btn-outline-dark mt-auto" })
                            </div>

                            <input type="hidden" name="ProductID" value="@item.ProductId" />
                            <div class="text-center">

                                <input type="submit" value="加入購物車" class="btn btn-outline-dark mt-auto" />
                            </div>
                        }

                    </div>
                </div>
            </div>
        }
    </div>
</div>
    
</body>
<style>
    .textbox {
        max-width: 3rem;
        justify-content: center
    }

   
</style>
@section  Scripts
    {
    <script>

        //PartialView
        function loadCarousel() {
            $('#headerCarousel').load('@Url.Content("~/shop/Carousel")');
        }
        loadCarousel();
        function loadSeenProduct() {
            $('#Seenproduct').load('@Url.Content("~/shop/SeenProduct")');
        }
        loadSeenProduct();
        function loadBodySel() {
            $('#BodySelSub').load('@Url.Content("~/shop/SelSubtag")');
        }
        loadBodySel();
        function loadHotProduct() {
            $('#Hotproduct').load('@Url.Content("~/shop/HotProduct")');
        }
        loadHotProduct();
        function loadFavorite() {
            $('#YourTop5').load('@Url.Content("~/shop/YourFavorite")');
        }
        loadFavorite();
        //PartialView

        var queryButton = document.getElementById('QueryAjax');


        queryButton.addEventListener('click', function () { QueryByAjax();});

        var ProductContent = document.querySelector('#ContentProduct');
        var DataControl = document.querySelector('#SortControl');//選項
        var errorContent = document.querySelector('#Eroor');

        DataControl.addEventListener('change', () => {
            var selectedValue = DataControl.value;

            switch (selectedValue) {
                case '1':
                    //最熱銷
                    break;
                case '2':
                    SortByDate();
                    break;
                case '3':
                    SortByPrice_h();//由高到低
                    break;
                case '4':
                    SortByPrice_l();//由低到高
                    break;
                default:
                    console.log('不確定要不要先放');
                    break;
            }
        });

        async function SortByPrice_h() {
            var queryKeyword = document.querySelector('#Kw').value;
            ProductContent.innerHTML = '';
            const response = await fetch(`@Url.Content("~/Shop/IndexbyPrice_H")?CK=${queryKeyword}`);
            const data = await response.json();
            if (data.message) {
                ProductContent.innerHTML = '<div class="alert alert-dark" role = "alert" > "查無資料，請確認輸入內容" </div>'
            }
            else {
                const productCards = data.map(createProductCard);
                ProductContent.innerHTML = productCards.join("");
            }
               
        }    
        async function SortByDate() {
            var queryKeyword = document.querySelector('#Kw').value;
            ProductContent.innerHTML = '';
            const response = await fetch(`@Url.Content("~/Shop/IndexbyDate")?CK=${queryKeyword}`);
            const data = await response.json();
            if (data.message) {
                ProductContent.innerHTML = '<div class="alert alert-dark" role = "alert" > "查無資料，請確認輸入內容" </div>'
            }
            else {
                const productCards = data.map(createProductCard);
                ProductContent.innerHTML = productCards.join("");
            }
        }
        async function SortByPrice_l() {
            var queryKeyword = document.querySelector('#Kw').value;
            ProductContent.innerHTML = '';
            const response = await fetch(`@Url.Content("~/Shop/IndexbyPrice_L")?CK=${queryKeyword}`);
            const data = await response.json();
            if (data.message) {
                ProductContent.innerHTML = '<div class="alert alert-dark" role = "alert" > "查無資料，請確認輸入內容" </div>'
            }
            else {
                const productCards = data.map(createProductCard);
                ProductContent.innerHTML = productCards.join("");
            }
        }
        async function QueryByAjax() 
        {
            var queryKeyword = document.querySelector('#Kw').value;
            ProductContent.innerHTML = '';
            const response = await fetch(`@Url.Content("~/Shop/IndexbyAjax")?CK=${queryKeyword}`);
            const data = await response.json();
            console.log(data);
            if (data.message) {
                ProductContent.innerHTML = '<div class="alert alert-dark" role = "alert" > "查無資料，請確認輸入內容" </div>'}
            else {
                const productCards = data.map(createProductCard);
                ProductContent.innerHTML = productCards.join("");
            }
        }
        //標籤搜尋
        var tags = document.querySelector('#tags');
        var tagclick = document.querySelector('.tagclick');
        tagclick.addEventListener('click', () => {
            console.log("click")
          ;
        })
       
        async function CreateTag() {

            const response = await fetch(`@Url.Content("~/Shop/GameTag")`);
            const data = await response.json();
            console.log(data);
            const subtagsDropdown = document.getElementById('Subtags');
            subtagsDropdown.innerHTML = '';
            const dropdownItems = data.map(tag => `<li><a class="dropdown-item" href="#!" value=${tag.subTagId}>${tag.name}</a></li>`);
            subtagsDropdown.innerHTML = dropdownItems.join('');
        }
      
        CreateTag();
        //標籤搜尋END

        //以下是商品呈現標準格式
        function createProductCard(product) {
            return `
                <div class="col mb-5">
                    <div class="card h-100">
                        <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Sale</div>
                                       <a href="@Url.Content("~/Shop/Details")?id=${product.productId}">  <img class="card-img-top" src="../images/shop/${product.FImagePath}" alt="..." style="height:25vh; " /></a>
                                <div class="card-body p-4"style="background-color:#4F4F4F">
                            <div class="text-center">
                                ${product.SubTagName.split('/').map(tag => `<span class="badge text-bg-light">${tag}</span>`).join("")}
                                        <h5 class="fw-bolder" style="color:black">${product.ProductName}</h5>
                                <div class="d-flex justify-content-center small text-warning mb-2">
                                    <div class="bi-star-fill"></div>
                                    <div class="bi-star-fill"></div>
                                    <div class="bi-star-fill"></div>
                                    <div class="bi-star-fill"></div>
                                    <div class="bi-star-fill"></div>
                                </div>
                                <span class="text-muted text-decoration-line-through">${product.Price}</span>
                                <span style="color:black">${product.Price}</span>
                            </div>
                        </div>
                                <div class="card-footer p-4 pt-0 border-top-0 " style="background-color:#4F4F4F">
                            <form action="/Shop/AddToCar" method="post">
                                <div class="text-center">
                                    <a href="/Shop/Details?id=${product.ProductId}" class="btn btn-outline-dark mt-auto">查看商品</a>
                                </div>
                                <div class="text-center">
                                    <a href="/Shop/Edit?id=${product.ProductId}" class="btn btn-outline-dark mt-auto">測試修改</a>
                                </div>
                                <input type="hidden" name="ProductID" value="${product.ProductId}" />
                                <div class="text-center">
                                    <input type="submit" value="加入購物車" class="btn btn-outline-dark mt-auto" />
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        }


              
    </script>
}
